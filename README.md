
# Поиск аномалий в телеметрии транспортного средства

Этот проект является учебным примером обнаружения аномалий в телеметрических данных с использованием автокодировщика на основе LSTM. Он предназначен исключительно для демонстрационных целей — систематические эксперименты по оптимизации параметров модели пока не проводились.


## Развертывание проекта

Для упрощения развертывания проект был контейнеризирован с использованием **Docker Compose**.


Для сборки и запуска всех сервисов в фоновом режиме выполните команду:


```bash
docker-compose up -d --build
```

По данной команде будут запущены следующие контейнеры:


`telemetry_service` - основной сервисный контейнер, содержащий два ключевых скрипта:
- generate_dataset - генератор синтетических временных рядов
- anomaly_detector - детектор аномалий во временных рядах

`telemetry_tests` - контейнер для тестирования:
- Запускает unit-тесты для проверки логики генерации временных рядов
- Создает обучающую, валидационную и тестовую выборки
- Параметры генерации данных настраиваются через файл .env
- Контейнер автоматически останавливается после выполнения

`train_model` - контейнер обучения модели:
- Выполняет цикл обучения на сгенерированных данных
- Создает артефакты модели, необходимые для детектирования аномалий
- Контейнер автоматически останавливается после завершения обучения

`tensorboard` - контейнер для мониторинга тренировки ML-моделей



### 1. Генератор синтетических телеметрических данных

Этот скрипт генерирует синтетические телеметрические данные для указанного типа транспортного средства на заданный промежуток времени.
По желанию могут быть добавлены аномалии (например, пробуксовка колёс, потеря сигнала GPS) с заданной пользователем вероятностью и продолжительностью.
Итоговый набор данных сохраняется в файл CSV с возможностью добавления меток аномалий.


Пример использования:


```
usage: python src/generate_dataset.py [-h] --vehicle VEHICLE [--minutes MINUTES] [--anomalies ANOMALIES [ANOMALIES ...]] [--labels]
                           [--output OUTPUT]

Produces synthetic telemetry data for a type of vehicle.

options:
  -h, --help            show this help message and exit
  --vehicle VEHICLE     Vehicle type and optional initial speed in the format: <vehicle_name>:<initial_speed>. Example:
                        Car:80 . Available vehicles: Car, Truck, ElectricVehicle (default: None)
  --minutes MINUTES     Duration of the generated data in minutes (minimum: 60). (default: 60)
  --anomalies ANOMALIES [ANOMALIES ...]
                        Space-separated list of anomaly types with their probabilities, in the format:
                        <anomaly_name>:<duration>:<probability>. Example: WheelSlip:0.01 GPSLoss:0.02 . Available
                        anomalies: WheelSlip, GPSLoss, SpeedSensorFreeze. If no anomalies are passed, a telemetry will
                        not contain distorted data. (default: None)
  --labels              Enable anomaly labels. (default: False)
  --output OUTPUT       Path to the CSV file where the dataset will be saved. (default: synthetic_dataset.csv)
```


#### Исходные параметры

Сгенерированная телеметрия включает три измеряемых параметра:
- wheel_rpm - частота вращения колеса (обороты в минуту)
- speed - скорость транспортного средства (км/ч)
- distance - пройденное расстояние по данным GPS (метры)

Данные имитируются с дискретностью 1 секунда:
- Параметры wheel_rpm и speed регистрируются системой телеметрии автомобиля
- Параметр distance измеряется независимо GPS-трекером


## 2. Детектирование аномалий

Для обнаружения аномалий в данных временных рядов используется автоэнкодер на основе LSTM, обученный на синтетически сгенерированных данных.

Этот скрипт принимает датасет и обнаруживает аномалий и выводит список временных интервалов с аномалией.

Пример использования:

```
usage: anomaly_detector.py [-h] --input INPUT [--output OUTPUT]

Analyses a time series.

options:
  -h, --help       show this help message and exit
  --input INPUT    Path to the CSV file containing the time series. (default: None)
  --output OUTPUT  Path to the file where the predictions results will be saved. (default: None)
```

Пример создания файла:

```
python src/anomaly_detector.py --input data/testing/test_Truck:80_120_WheelSlip:5:0.01.csv
```

Пример получения временных интервалов (нижняя и верхняя границы):

```
python src/anomaly_detector.py --input data/testing/test_Truck:80_120_WheelSlip:5:0.01.csv --output data/results_Truck:80_120_WheelSlip:5:0.01.csv
```


## Процесс обучения LSTM-автоэнкодера

1. Входные данные
Это многомерный временной ряд с тремя числовыми признаками: wheel_rpm, speed, distance, изменяющимися во времени.

2. Предобработка данных: преобразовать необработанный временной ряд в последовательности фиксированной длины (окна), на которых будет обучаться модель.

- Нормализация: используется StandardScaler, обученный на тренировочных данных.

- Оконное разбиение: выбирается размер окна W, и временной ряд преобразуется в перекрывающиеся окна формы.

3. Архитектура модели LSTM-автоэнкодер:
- Энкодер: сжимает входную последовательность в латентный вектор (изучает нормальные шаблоны). Форма входа: [batch_size, window_size, num_features];
- Декодер: восстанавливает исходную последовательность из латентного вектора.

4. Стратегия обучения: модель обучается только на нормальных данных.
Она учится восстанавливать нормальное поведение.
Функция потерь: среднеквадратичная ошибка (MSE) между входом и реконструкцией.


5. Обнаружение аномалий после обучения: в тестовых данных рассчитывается ошибка реконструкции.
Порог ошибки определяется во время обучения, но может быть изменён через файл .env.

6. Оценка: для оценки модели используются истинные метки из тестового набора с метрик точность (precision), полнота (recall), F1-мера (F1-score).